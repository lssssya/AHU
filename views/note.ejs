<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>不忘_登陆_测试</title>
	<link rel="stylesheet" href="/css/index.css">
	<link rel="stylesheet" href="/lib/bootstrap/dist/css/bootstrap.css">
	<script src="/lib/jquery/jquery.js"></script>
</head>
<body>
	<%- include('common/home-aside.ejs') -%>
	<!--右边下部分，网站的主体页面-->
  <div class="main">
		<div class="return-btn">
		  <img src="/img/return-lg.jpg" id="btnReturn">
		</div>
		<div class="body">
      <div class="note-title">
        <%= data.noteTitle %>
      </div>
      <div class="note-detail">
        <div class="note-detail-header">
          <img src=<%= data.noteCoverUrl %>>
        <div class="note-title"><%= data.noteTitle %></div>
        </div>
        <hr class="cutLine" />
        <div class="note-detail-content">
          <ul>
            <li>进展<span>&nbsp;&nbsp;<%= data.noteCountProgress %></span></li>
            <li>关注<span>&nbsp;&nbsp;<%= data.noteCountFollower %></span></li>
            <li>点赞<span>&nbsp;&nbsp;<%= data.noteCountLiked %></span></li>
            <li>评论<span>&nbsp;&nbsp;<%= data.noteCountComment %></span></li>
          </ul>
        </div>
        <hr class="cutLine" />
        <div class="note-detail-foot">
        <%= data.noteIntroduction %>
        </div>
      </div>
      <div class="note-body">
        <div class="addRecord">
          <form>	
            <div class="form-group ">
              <label for="addRecord">分享现在的心情</label>
              <textarea rows="4" cols="30" class="form-control" id="addRecord" placeholder="+ 添加"></textarea>
            </div>
            <button type="submit" class="btn btn-primary btn-lg" id="btn">发布</button>
          </form>
        </div>
        <div class="note-content">
          <ul class="p-ul">
            <% data.progress.forEach(function(item){ %>
              <li class="record-items">
                <div class="r-items-header">
                  <div class="info-time"><span><%= item.recordTime %></span></div>
                </div>
                <div class="r-items-content">
                  <div class="record-content"> <p><%= item.recordContent %></p></div>     
                </div>
                <div class="r-items-foot">
                  <hr class="cutLine" />
                  <div class="items-info">
                    <a id=<%= item.recordID %>liked>赞</a><span>&nbsp;&nbsp;<%= item.recordLiked %> &nbsp;</span>
                    <a id=<%= item.recordID %>>评论</a><span>&nbsp;&nbsp;<%= item.recordComment %>&nbsp; </span>
                    <a id="delete" style="float:right;margin-right:10px;">删除</a>
                    <a id="edit" style="float:right;margin-right:10px;">编辑</a>
                  </div>
                  <div class="commentbox" id=<%= item.recordID %>commentbox >
                    <div class="panel panel-default">
                      <ul class="list-group" id=<%= item.recordID%>ul>
                        <% item.comment.forEach(function(item){ %>
                        <li class="list-group-item"><a href="#"><%= item.nickname %></a><span>&nbsp;:&nbsp;<%= item.comment %></span></li>
                        <%}); %>
                      </ul>
                    </div>
                    <div>
                      <form class="form-inline">  
                        <input type="text" class="form-control" id=<%= item.recordID %>input >
                        <button type="submit" class="btn btn-primary" id=<%= item.recordID %>comment>发布</button>
                      </form>
                    </div>
                  </div>
                </div>
              </li>
            <%});%>
          </ul>
        </div>
      </div>
    </div>
    
	</div>
<script>
$(document).ready(function(){

    // $("#btn").click(function(evetn){
    //   event.preventDefault();
    //   var add = $("#addrecord").val();
    //   var data = {"recordContent":add}
    //   $.ajax({
    //     type: 'POST',
    //     url: '/note:id'
    //     data: data,
    //     success:function(data){}
    //   });
    // });



    var a = document.querySelector('.note-content');
    a.addEventListener('click', function(event){
      var id = event.target.id;
      if($("#"+id+"commentbox").css("display")=="none"){  
        $("#"+id+"commentbox").show();  
      }else{  
        $("#"+id+"commentbox").hide();
      };

      $("#"+id+"comment").click(function(event){
        ulID = id+"ul";
        event.preventDefault();
        var comment = $("#"+id+"input").val();
        var data={"comment":comment,"recordID":id}
        var ul = document.getElementById(ulID);
        var newLi = document.createElement('li');
        var text = '<li class="list-group-item"><a href="#">'+id+'</a><span>&nbsp;:&nbsp;'+comment+'</span></li>';
        newLi.innerHTML=text;
        setTimeout(function(){
          ul.appendChild(newLi)
        },1000); // 假装上传且实时更新  其实是Ajax 可以完成但是先不写

        // $.ajax({
        //     type: 'POST',
        //     url: 
        //     data: data,
        //     success:function(data){
              
        //     }
        // });


      });

    },false);
    
    $("#liked").click(function(){

    });

    $("#delete").click(function(){

    });
});


  //给return的图片一个点击事件
  $("#btnReturn").click(function(){   
    location.href='/home'; 
  });

</script>
</body>
</html>